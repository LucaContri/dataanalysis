<!DOCTYPE html>
<html>
<style>

.chart rect {
  fill: steelblue;
}

.chart text {
  fill: black;
  font: 10px sans-serif;
  text-anchor: end;
}

.axis text {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.legend text {
  padding: 5px;
  font: 14px sans-serif;
  background: yellow;
  box-shadow: 2px 2px 1px #888;
}

</style>
<head>
  	<title>Audit Days Summary 2013/2014</title>
  	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	<script type="text/javascript">
		function init() {
			var margin = {top: 20, right: 40, bottom: 30, left: 100},
				legendDim = {width: 120},
			    width = 960 - margin.left - margin.right - legendDim.width,
			    height = 500 - margin.top - margin.bottom,
			    visual = {delay: 1000};

			var x = d3.scale.ordinal()
		    	.rangeRoundBands([0, width], .1);
			
			var y = d3.scale.linear()
		    	.range([height, 0]);

			var xAxis = d3.svg.axis()
		    	.scale(x)
		    	.orient("bottom");

			var yAxis = d3.svg.axis()
			    .scale(y)
			    .orient("left");
				//.ticks(10, "%");
		
			var chart = d3.select(".chart")
			    .attr("width", width + margin.left + margin.right +legendDim.width)
			    .attr("height", height + margin.top + margin.bottom)
			    .append("g")
    			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			
			d3.json("auditDaysSummary", function(error, json) {
				  if (error) return console.warn(error);
				  var data = json[1].data;
				  var date = json[1].date;
				  y.domain([0, d3.max(data, function(d) { return d.value; })]);
				  x.domain(data.map(function(d) { return d.period; }));
				  
				  chart.append("g")
				      .attr("class", "x axis")
				      .attr("transform", "translate(0," + height + ")")
				      .call(xAxis);

			  	  chart.append("g")
				      .attr("class", "y axis")
				      .call(yAxis)
				      .append("text")
					  .attr("transform", "rotate(-90)")
					  .attr("y", -50)
					  .attr("x", -height/2-margin.top)
					  .attr("dy", ".71em")
					  .style("text-anchor", "end")
					  .text("Days");
			  				
				  var legend = chart.append("g")
					  .attr("class", "legend")
					  .attr("x", width+margin.right)
					  .attr("y", margin.top)
					  .attr("height", 100)
					  .attr("width", 100);
					
					legend.append("text")
					  .attr("x", width + margin.right + legendDim.width)
					  .attr("y", margin.top)
					  .text("");
					
					legend.append("rect")
					  .attr("x", width + margin.right)
					  .attr("y", margin.top + 50)
					  .attr("width", 20)
					  .attr("height", 20)
					  .style("fill", "steelblue");
					
					legend.append("text")
					  .attr("x", width + margin.right + 100)
					  .attr("y", margin.top + 70)
					  .text("Available");
					
				  	var bars = chart.selectAll(".bar")
				      .data(data)
				      .enter()
				      .append("rect")
				      .attr("class", "bar")
				      .attr("x", function(d) { return x(d.period); })
				      .attr("y", function(d) { return y(d.value); })
				      .attr("height", function(d) { return height - y(d.value); })
				      .attr("width", x.rangeBand());
				    
				      json.forEach(function(instance, index) {
						bars.data(instance.data);
					    bars
					      .transition()
	    				  .duration(visual.delay)
	    				  .ease("quad")
	    				  .delay(function(d, i) { return index * visual.delay; })
	    				  .attr("y", function(d) { return y(d.value); })
	    				  .attr("height", function(d) { return height - y(d.value); });
					    
					    legend.select("text")
					      .transition()
	    				  .duration(visual.delay)
	    				  .ease("quad")
	    				  .delay(function(d, i) { return index * visual.delay; })
						  .attr("x", width + margin.right+legendDim.width)
						  .attr("y", margin.top)
						  .text("Date: " + instance.date);
				      });
				});
		}
	</script>

</head>
<body onload="init()">
  <h1>Audit Days Summary 2013/2014</h1>
  <svg class="chart"></svg>
</body>
</html>